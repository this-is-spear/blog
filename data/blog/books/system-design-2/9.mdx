---
title: 9. S3와 유사한 객체 저장소
date: '2024-05-26'
tags: ['책', '대규모 시스템 설계 기초 2']
draft: true
summary: 
images: []
---

## 0 단계 : 저장소 시스템 101

저장소 시스템은 block storage, file storage, object storage 세 가지 부류로 나뉜다.

### block storage

`block storage`는 `raw block`을 `volume` 형태로 제공한다.
서버는 raw block을 포맷해서 파일 시스템으로 이용하거나 애플리케이션에 `block 제어권`을 넘긴다.
`db`나 `vm application`은 `raw block`을 직접 제어해 최대한 성능을 이끌어 낸다.

> 여기에서 block을 디스크 저장 단위를 의미한다.

### file storage

`file storage`는 `block storage`에서 구현된다.
파일 시스템을 위한 추상화를 제공하고 데이터는 디렉토리 계층으로 보관된다.

### object storage

`object storage`는 수평적 구조로 데이터를 저장하며 REST API를 이용해 접근한다.
다른 유형 저장소에 비해 느린데, 영속성을 높이는 과정에서 비용을 줄이기 위해 의도적으로 성능을 희생한다.

## 1 단계 : 문제 이해 및 설계 범위 확장

- 기능 요구사항 정제
  - 버킷 생성, 객체 업로드 및 다운로드, 객체 버전, 객체 목록 조회 기능 지원
  - 데이터 크기 고려한다
  - 연 단위 추가되는 데이터 규모
  - 데이터 내구성과 서비스 가용성 보장
- 비기능 요구사항 정제
  - six nines(99.9999%) 수준의 데이터 내구성
  - four nines(99.99%) 수준의 서비스 가용성
  - 높은 수준의 안정성과 성능을 보증하되 저장소 비용은 최소화해야 한다.

대략적인 규모를 측정해보겠다. 저장되는 객체 크기를 다음처럼 산정한다.

- 20% 정도의 0.5MB 정도의 객체
- 60% 정도의 64MB 정도의 객체
- 20% 정도의 200MB 정도의 객체

100PB 규모 디스크를 사용하고 40%정도 채워져 있다면 (10^11 * 0.4) / (0.2 * 0.5 + 0.6 * 32 + 0.2 * 200) 으로 6억 8천만 개의 객체가 있다고 예상할 수 있다.
그럼 다음과 같은 결론이 나온다.

- 모든 객체의 메타데이터 크기가 1KB이면 객체 메타데이터는 0.68 TB 양이 필요하다.

7200rpm 하드 디스크를 사용할 때 IOPS(초당 디스크 IO)가 초당 100 ~ 150회를 사용한다고 가정해면 다음과 같은 결론을 낼 수 있다.

- 6억 8천 만 개의 메타데이터를 초회할 때 초당 100 ~ 150로 조회할 수 있다.

## 2 단계 : 개략적 설계안 제시 및 동의 구하기

### 객체 저장소 특징

객체 저장소는 `객체 불변성(object immutability)`과 `키-값 저장소(key-value store)` 그리고 `소형 및 대형 객체 동시 지원`이라는 특징을 가진다.

- 객체 불변성 : 객체 저장소에 보관되는 객체는 변경이 불가능하다. 새 버전으로 대체할 수 있어도 값을 점진적으로 변경할 수 없다.
- 키-값 저장소 : 해당 객체의 URI를 사용해 데이터를 가져올 수 있다. URI를 키로 키-값 저장소 형태를 띈다.
- 소형 및 대형 객체 동시 지원 : 다양한 크기 객체를 문제없이 저장할 수 있다.

이런 특징으로 객체 저장소의 접근 패턴을 고려하면 저장보다 읽기가 많다는 것을 이해할 수 있다.
조사에의 하면 95% 가량이 읽기 요청이다.

### 객체 관리 방법

UNIX에선 데이터와 메타데이터를 따로 관리한다.
파일 메타데이터를 inode에 보관하고 필요할 때마다 inode 정보를 읽어 저장된 위치를 파악한다.
객체 저장소도 동일한 방식을 차용했다. 메타데이터 저장소에서 객체 이름으로 객체 ID를 조회하고 객체 ID를 이용해 데이터를 찾게 된다.

### 개략적 설계안

메타데이터와 데이터가 분리된 개략적 설계안은 다음과 같다.

![그림 1](/static/images/books/system-design-2/nine/1.png)

## 3 단계 : 상세 설계

## 4 단계 : 마무리
